<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div>
        <h1 class="dashboard-title">üéØ AutoQP Dashboard</h1>
        <p class="dashboard-subtitle">Find value betting opportunities on SplashProps</p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-label">Total Props</div>
          <div class="stat-value">{{ totalProps }}</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label">Value Plays</div>
          <div class="stat-value">{{ valuePlayCount }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Edge</div>
          <div class="stat-value">{{ averageEdge }}%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls Section -->
  <div class="controls-section">
    <div class="row g-3">
      <!-- Search -->
      <div class="col-md-4">
        <div class="search-box">
          <input 
            type="text" 
            class="form-control form-control-lg" 
            placeholder="üîç Search by player or prop type..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="onFilterChange()"
          />
        </div>
      </div>

      <!-- Odds Threshold Filter -->
      <div class="col-md-3">
        <div class="filter-group">
          <label class="filter-label">Odds Threshold</label>
          <div class="input-group">
            <span class="input-group-text">‚â§</span>
            <input 
              type="number" 
              class="form-control" 
              [(ngModel)]="filterOddsThreshold"
              (ngModelChange)="onFilterChange()"
            />
          </div>
          <small class="text-muted">Typically -135</small>
        </div>
      </div>

      <!-- Exchange Filter -->
      <div class="col-md-3">
        <div class="filter-group">
          <label class="filter-label">Exchange</label>
          <select 
            class="form-select form-select-sm"
            [(ngModel)]="filterExchange"
            (ngModelChange)="onFilterChange()"
          >
            <option value="all">All Exchanges</option>
            <option value="ProphetX">ProphetX</option>
            <option value="Novig">Novig</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>

      <!-- Sort Options -->
      <div class="col-md-2">
        <div class="filter-group">
          <label class="filter-label">Sort By</label>
          <div class="sort-buttons">
            <button 
              class="sort-btn"
              [class.active]="sortBy === 'average_odds'"
              (click)="onSortChange('average_odds')"
              title="Sort by average odds"
            >
              AVG {{ sortDescending && sortBy === 'average_odds' ? '‚Üì' : '‚Üë' }}
            </button>
            <button 
              class="sort-btn"
              [class.active]="sortBy === 'best_odds'"
              (click)="onSortChange('best_odds')"
              title="Sort by best odds"
            >
              BEST {{ sortDescending && sortBy === 'best_odds' ? '‚Üì' : '‚Üë' }}
            </button>
            <button 
              class="sort-btn"
              [class.active]="sortBy === 'win_probability'"
              (click)="onSortChange('win_probability')"
              title="Sort by win probability"
            >
              WIN% {{ sortDescending && sortBy === 'win_probability' ? '‚Üì' : '‚Üë' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Props Table Section -->
  <div class="props-section">
    <div class="section-header">
      <h2>Available Props</h2>
      <span class="badge bg-primary">{{ filteredProps.length }} shown</span>
    </div>

    <div class="table-wrapper">
      <!-- Top scrollbar -->
      <div class="table-scrollbar table-scrollbar-top">
        <div class="table-scrollbar-content"></div>
      </div>
      
      <div class="table-responsive">
        <table class="props-table">
        <thead>
          <tr>
            <th class="col-player">Player</th>
            <th class="col-prop">Prop Type</th>
            <th class="col-line">Splash Line</th>
            <!-- Dynamic bookie ID columns (individual books) -->
            <th *ngFor="let bookieId of allBookieIds" class="col-book text-center">
              <div class="book-header">
                <div class="book-id">{{ bookieId }}</div>
                <div class="book-exchange">{{ getExchangeForBookie(bookieId) }}</div>
              </div>
            </th>
            <th class="col-average text-center">Average</th>
            <!-- Exchange columns (right side) - positioned from right edge -->
            <!-- Order from right: Actions (0), Win % (110), Exchanges (220, 320, 420...), Average (520+) -->
            <th *ngFor="let exchange of allExchanges; let i = index" 
                class="col-exchange text-center"
                [style.right.px]="110 + 110 + ((allExchanges.length - 1 - i) * 100)">
              <div class="exchange-header">
                <div class="exchange-name">{{ exchange }}</div>
              </div>
            </th>
            <th class="col-winprob text-center">Win %</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredProps.length === 0" class="empty-state">
            <td [attr.colspan]="4 + allBookieIds.length + allExchanges.length + 1" class="text-center py-5">
              <p class="text-muted mb-2">No props match your criteria</p>
              <small class="text-muted">Try adjusting your filters or enter odds for available props</small>
            </td>
          </tr>

          <tr *ngFor="let prop of filteredProps" 
              [class.value-play]="prop.is_value_play"
              class="prop-row">
            <!-- Player Name -->
            <td class="col-player">
              <div class="player-info">
                <strong>{{ prop.entity_name }}</strong>
              </div>
            </td>

            <!-- Prop Type -->
            <td class="col-prop">
              <span class="badge bg-light text-dark">{{ prop.type_display }}</span>
            </td>

            <!-- Splash Line -->
            <td class="col-line">
              <span class="line-badge">{{ prop.line }}</span>
            </td>

            <!-- Bookie ID columns (individual books) -->
            <td *ngFor="let bookieId of allBookieIds" class="col-book text-center">
              <div *ngIf="prop.odds_by_bookie && prop.odds_by_bookie[bookieId.toString()]" 
                   class="book-odds">
                <div class="odds-side" *ngIf="prop.side_by_bookie && prop.side_by_bookie[bookieId.toString()] && prop.side_by_bookie[bookieId.toString()] !== 'unknown'">
                  <span class="side-badge" [ngClass]="prop.side_by_bookie[bookieId.toString()] === 'over' ? 'badge-over' : 'badge-under'">
                    {{ prop.side_by_bookie[bookieId.toString()] === 'over' ? 'O' : 'U' }}
                  </span>
                </div>
                <strong [ngClass]="getOddsColor(prop.odds_by_bookie[bookieId.toString()])">
                  {{ prop.odds_by_bookie[bookieId.toString()] }}
                </strong>
              </div>
              <div *ngIf="!prop.odds_by_bookie || !prop.odds_by_bookie[bookieId.toString()]" 
                   class="text-muted">‚Äî</div>
            </td>

            <!-- Average Odds -->
            <td class="col-average text-center">
              <div *ngIf="prop.average_odds !== undefined && prop.average_odds !== 0" class="average-odds">
                <strong [ngClass]="getOddsColor(prop.average_odds)">{{ prop.average_odds }}</strong>
              </div>
              <div *ngIf="prop.average_odds === undefined || prop.average_odds === 0" class="text-muted">
                ‚Äî
              </div>
            </td>

            <!-- Exchange columns (right side) - positioned from right edge -->
            <!-- Order from right: Actions (0), Win % (110), Exchanges (220, 320, 420...), Average (520+) -->
            <td *ngFor="let exchange of allExchanges; let i = index" 
                class="col-exchange text-center"
                [style.right.px]="110 + 110 + ((allExchanges.length - 1 - i) * 100)">
              <div *ngIf="prop.odds_by_exchange && prop.odds_by_exchange[exchange]" 
                   class="exchange-odds">
                <div class="odds-side" *ngIf="prop.primary_side">
                  <span class="side-badge" [ngClass]="prop.primary_side === 'over' ? 'badge-over' : 'badge-under'">
                    {{ prop.primary_side === 'over' ? 'O' : 'U' }}
                  </span>
                </div>
                <strong [ngClass]="getOddsColor(prop.odds_by_exchange[exchange])">
                  {{ prop.odds_by_exchange[exchange] }}
                </strong>
              </div>
              <div *ngIf="!prop.odds_by_exchange || !prop.odds_by_exchange[exchange]" 
                   class="text-muted">‚Äî</div>
            </td>

            <!-- Win Probability -->
            <td class="col-winprob text-center">
              <div *ngIf="prop.win_probability !== undefined" class="win-probability">
                <strong [ngClass]="prop.win_probability >= 57.0 ? 'text-success' : prop.win_probability >= 52.0 ? 'text-info' : 'text-muted'">
                  {{ prop.win_probability.toFixed(2) }}%
                </strong>
              </div>
              <div *ngIf="prop.win_probability === undefined && prop.average_odds !== undefined" class="text-muted small">
                {{ oddsToImpliedProbability(prop.average_odds) }}%
              </div>
              <div *ngIf="prop.win_probability === undefined && prop.average_odds === undefined" class="text-muted">
                ‚Äî
              </div>
            </td>

            <!-- Actions -->
            <td class="col-actions">
              <div class="action-buttons">
                <button 
                  class="btn btn-sm btn-outline-success"
                  *ngIf="prop.is_value_play"
                  title="This is a value play!"
                >
                  ‚≠ê Value
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      
      <!-- Bottom scrollbar -->
      <div class="table-scrollbar table-scrollbar-bottom">
        <div class="table-scrollbar-content"></div>
      </div>
    </div>

    <!-- Legend -->
    <div class="table-legend">
      <div class="legend-item">
        <span class="legend-color good"></span>
        <span>Great odds (‚â§ -150)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color okay"></span>
        <span>Good odds (-135 to -150)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color poor"></span>
        <span>Fair odds (-110 to -135)</span>
      </div>
    </div>
  </div>

  <!-- Tips Section -->
  <div class="tips-section">
    <h5>üí° Quick Tips</h5>
    <ul>
      <li><strong>Add Market Odds:</strong> Click "+ Add Odds" to manually enter odds from Unabated</li>
      <li><strong>Track Exchanges:</strong> Mark ProphetX and Novig for higher liquidity plays</li>
      <li><strong>Value Plays:</strong> Props marked with ‚≠ê are better than -135 threshold</li>
      <li><strong>Implied Probability:</strong> See what the market thinks the true win probability is</li>
      <li><strong>Average Odds:</strong> Simple average across all entered odds‚Äîdirectionally correct, not precise</li>
    </ul>
  </div>
</div>