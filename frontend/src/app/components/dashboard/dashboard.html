<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div>
        <h1 class="dashboard-title">üéØ AutoQP Dashboard</h1>
        <p class="dashboard-subtitle">Find value betting opportunities on SplashProps</p>
      </div>
      <div class="header-stats">
        <div class="stat-card">
          <div class="stat-label">Total Props</div>
          <div class="stat-value">{{ totalProps }}</div>
        </div>
        <div class="stat-card highlight">
          <div class="stat-label">Value Plays</div>
          <div class="stat-value">{{ valuePlayCount }}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Edge</div>
          <div class="stat-value">{{ averageEdge }}%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls Section -->
  <div class="controls-section">
    <div class="row g-3">
      <!-- Search -->
      <div class="col-md-4">
        <div class="search-box">
          <input 
            type="text" 
            class="form-control form-control-lg" 
            placeholder="üîç Search by player or prop type..."
            [(ngModel)]="searchQuery"
            (ngModelChange)="onFilterChange()"
          />
        </div>
      </div>

      <!-- Odds Threshold Filter -->
      <div class="col-md-3">
        <div class="filter-group">
          <label class="filter-label">Odds Threshold</label>
          <div class="input-group">
            <span class="input-group-text">‚â§</span>
            <input 
              type="number" 
              class="form-control" 
              [(ngModel)]="filterOddsThreshold"
              (ngModelChange)="onFilterChange()"
            />
          </div>
          <small class="text-muted">Typically -135</small>
        </div>
      </div>

      <!-- Exchange Filter -->
      <div class="col-md-3">
        <div class="filter-group">
          <label class="filter-label">Exchange</label>
          <select 
            class="form-select form-select-sm"
            [(ngModel)]="filterExchange"
            (ngModelChange)="onFilterChange()"
          >
            <option value="all">All Exchanges</option>
            <option value="ProphetX">ProphetX</option>
            <option value="Novig">Novig</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>

      <!-- Sort Options -->
      <div class="col-md-2">
        <div class="filter-group">
          <label class="filter-label">Sort By</label>
          <div class="sort-buttons">
            <button 
              class="sort-btn"
              [class.active]="sortBy === 'average_odds'"
              (click)="onSortChange('average_odds')"
              title="Sort by average odds"
            >
              AVG {{ sortDescending && sortBy === 'average_odds' ? '‚Üì' : '‚Üë' }}
            </button>
            <button 
              class="sort-btn"
              [class.active]="sortBy === 'best_odds'"
              (click)="onSortChange('best_odds')"
              title="Sort by best odds"
            >
              BEST {{ sortDescending && sortBy === 'best_odds' ? '‚Üì' : '‚Üë' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Props Table Section -->
  <div class="props-section">
    <div class="section-header">
      <h2>Available Props</h2>
      <span class="badge bg-primary">{{ filteredProps.length }} shown</span>
    </div>

    <div class="table-responsive">
      <table class="props-table">
        <thead>
          <tr>
            <th class="col-player">Player</th>
            <th class="col-prop">Prop Type</th>
            <th class="col-line">Splash Line</th>
            <th class="col-odds">Market Odds</th>
            <th class="col-average">Average</th>
            <th class="col-exchanges">Exchanges</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredProps.length === 0" class="empty-state">
            <td colspan="7" class="text-center py-5">
              <p class="text-muted mb-2">No props match your criteria</p>
              <small class="text-muted">Try adjusting your filters or enter odds for available props</small>
            </td>
          </tr>

          <tr *ngFor="let prop of filteredProps" 
              [class.value-play]="prop.is_value_play"
              class="prop-row">
            <!-- Player Name -->
            <td class="col-player">
              <div class="player-info">
                <strong>{{ prop.entity_name }}</strong>
              </div>
            </td>

            <!-- Prop Type -->
            <td class="col-prop">
              <span class="badge bg-light text-dark">{{ prop.type_display }}</span>
            </td>

            <!-- Splash Line -->
            <td class="col-line">
              <span class="line-badge">{{ prop.line }}</span>
            </td>

            <!-- Market Odds Entry -->
            <td class="col-odds">
              <div class="odds-entry-cell">
                <div *ngIf="prop.odds_entries.length === 0" class="empty-odds">
                  <button 
                    class="btn btn-sm btn-outline-primary"
                    (click)="setEditingProp(prop.id)"
                  >
                    + Add Odds
                  </button>
                </div>

                <div *ngIf="editingPropId === prop.id" class="odds-form">
                  <div class="input-group input-group-sm mb-2">
                    <input 
                      type="text" 
                      class="form-control" 
                      placeholder="Sportsbook"
                      [(ngModel)]="newOddsEntry.sportsbook"
                    />
                    <input 
                      type="number" 
                      class="form-control" 
                      placeholder="Odds (e.g., -135)"
                      [(ngModel)]="newOddsEntry.odds"
                    />
                    <select class="form-select form-select-sm" [(ngModel)]="newOddsEntry.exchange">
                      <option value="">Exchange</option>
                      <option value="ProphetX">ProphetX</option>
                      <option value="Novig">Novig</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div class="d-flex gap-2">
                    <button 
                      class="btn btn-sm btn-success"
                      (click)="addOddsEntry(prop.id)"
                    >
                      ‚úì Add
                    </button>
                    <button 
                      class="btn btn-sm btn-secondary"
                      (click)="setEditingProp(null)"
                    >
                      ‚úï Cancel
                    </button>
                  </div>
                </div>

                <div *ngIf="editingPropId !== prop.id && prop.odds_entries.length > 0" class="odds-list">
                  <div *ngFor="let entry of prop.odds_entries; let i = index" class="odds-item">
                    <div class="odds-item-content">
                      <strong [ngClass]="getOddsColor(entry.odds)">{{ entry.odds }}</strong>
                      <span class="odds-item-label">{{ entry.sportsbook }}</span>
                      <span *ngIf="entry.exchange" class="exchange-badge">{{ entry.exchange }}</span>
                    </div>
                    <button 
                      class="btn btn-sm btn-link text-danger p-0"
                      (click)="removeOddsEntry(prop.id, i)"
                      title="Remove this odds entry"
                    >
                      ‚úï
                    </button>
                  </div>
                  <button 
                    class="btn btn-sm btn-outline-primary mt-2 w-100"
                    (click)="setEditingProp(prop.id)"
                  >
                    + Add Another
                  </button>
                </div>
              </div>
            </td>

            <!-- Average Odds -->
            <td class="col-average text-center">
              <div *ngIf="prop.average_odds !== undefined" class="average-odds">
                <strong [ngClass]="getOddsColor(prop.average_odds)">{{ prop.average_odds }}</strong>
                <div class="text-muted small">
                  {{ oddsToImpliedProbability(prop.average_odds) }}% win prob
                </div>
              </div>
              <div *ngIf="prop.average_odds === undefined" class="text-muted">
                ‚Äî
              </div>
            </td>

            <!-- Exchanges Included -->
            <td class="col-exchanges">
              <div *ngIf="prop.exchanges_included && prop.exchanges_included.length > 0" class="exchange-badges">
                <span *ngFor="let exchange of prop.exchanges_included" class="exchange-badge-primary">
                  {{ exchange }}
                </span>
              </div>
              <div *ngIf="!prop.exchanges_included || prop.exchanges_included.length === 0" class="text-muted small">
                ‚Äî
              </div>
            </td>

            <!-- Actions -->
            <td class="col-actions">
              <div class="action-buttons">
                <button 
                  class="btn btn-sm btn-outline-success"
                  *ngIf="prop.is_value_play"
                  title="This is a value play!"
                >
                  ‚≠ê Value
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Legend -->
    <div class="table-legend">
      <div class="legend-item">
        <span class="legend-color good"></span>
        <span>Great odds (‚â§ -150)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color okay"></span>
        <span>Good odds (-135 to -150)</span>
      </div>
      <div class="legend-item">
        <span class="legend-color poor"></span>
        <span>Fair odds (-110 to -135)</span>
      </div>
    </div>
  </div>

  <!-- Tips Section -->
  <div class="tips-section">
    <h5>üí° Quick Tips</h5>
    <ul>
      <li><strong>Add Market Odds:</strong> Click "+ Add Odds" to manually enter odds from Unabated</li>
      <li><strong>Track Exchanges:</strong> Mark ProphetX and Novig for higher liquidity plays</li>
      <li><strong>Value Plays:</strong> Props marked with ‚≠ê are better than -135 threshold</li>
      <li><strong>Implied Probability:</strong> See what the market thinks the true win probability is</li>
      <li><strong>Average Odds:</strong> Simple average across all entered odds‚Äîdirectionally correct, not precise</li>
    </ul>
  </div>
</div>